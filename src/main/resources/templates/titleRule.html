<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="//cdn.staticfile.org/layui/2.9.7/css/layui.css" rel="stylesheet">
</head>
<body>
<div style="padding: 15px;">
    <blockquote class="layui-elem-quote">
        该页面展示公告标题的过滤规则，必须包含所有关键字，才会去分析公告里面的内容
        <div class="layui-form-item">
            <div class="layui-input-group">
                <div class="layui-input-split layui-input-prefix">
                    关键字
                </div>
                <input id="keyword" type="text" placeholder="请输入关键字" class="layui-input">
                <div class="layui-input-suffix">
                    <button class="layui-btn" lay-submit lay-filter="demo-table-export" onclick="add()">添加关键字
                    </button>
                </div>
            </div>
        </div>
    </blockquote>

    <div class="layui-card layui-panel">
        <table class="layui-table" lay-data="{height:'auto', url:'/rule', page:true,limit:20}"
               id="ID-table-demo-init">
            <thead>
            <tr>
                <th lay-data="{field:'id', width:80}">ID</th>
                <th lay-data="{field:'keyword'}">关键字</th>
                <th>操作</th>
            </tr>
            </thead>
        </table>
    </div>
    <br><br>
</div>
<script src="//cdn.staticfile.org/layui/2.9.7/layui.js"></script>
<script>
    var tableIns; // 全局变量用于存储表格实例
    var $
    layui.use(['table', 'jquery'], function () {
        var table = layui.table;
         $ = layui.jquery;

        // 渲染表格
        tableIns = table.render({
            elem: '#ID-table-demo-init',
            url: '/rule', // 模拟接口地址
            page: true,
            limit: 20,
            cols: [[
                { field: 'LAY_NUM',title:'序号', type:"number" },
                { field: 'keyword', title: '关键字' },
                { title: '操作', toolbar: '#toolbarDemo' }
            ]]
        });


        // 监听工具栏事件
        table.on('tool(ID-table-demo-init)', function (obj) {
            var data = obj.data;
            if (obj.event === 'delete') {
                deleteRow(data.id);
            }
        });
    });

    // 删除行操作
    function deleteRow(id) {
        // 这里可以发送删除请求到后端，这里仅演示
        layer.confirm('确定删除该行数据？', function (index) {
            // 模拟删除成功
            $.ajax({
                url: '/rule/' + id,
                type: 'DELETE',
                success: function (data) {
                    // 处理删除成功的逻辑
                    alert(data);
                    reloadTable();
                },
                error: function (xhr, status, error) {
                    // 处理请求失败的逻辑
                    alert(xhr.responseText);
                }
            });
            layer.close(index);
        });
    }

    // 刷新表格
    function reloadTable() {
        tableIns.reload();
    }

    // 添加关键字
    function add() {
        var keyword = $('#keyword').val();
        $.ajax({
            url: '/rule',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({ keyword: keyword }),
            success: function(data) {
                // 处理接口返回的数据
                alert(data);
                reloadTable(); // 调用全局的 reloadTable 函数
            },
            error: function(xhr, status, error) {
                // 处理请求失败的逻辑
                alert(xhr.responseText);
            }
        });
    }
</script>

<!-- 操作列的工具栏模板 -->
<script type="text/html" id="toolbarDemo">
    <button class="layui-btn layui-btn-danger layui-btn-xs" lay-event="delete">删除</button>
</script>
</body>
</html>